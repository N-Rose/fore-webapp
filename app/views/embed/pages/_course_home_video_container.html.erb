<%= Gon::Base.render_data %>
<div class= "player-container" progress-color="<%=color_selector(@course.color_selector)%>">
  <div class = "upper-gradient"></div>
  <div class="vplayer" id="vplayer">
    <video id="home-vid" class="video-js vjs-default-skin vjs-big-play-centered video_container" playsinline></video>

    <div class="previous on-video"> <%= image_tag "left.png" %> </div>
    <div class="next on-video"><%= image_tag "right.png" %></div>
    <div class="logo on-video"><%= link_to image_tag(logo_on_video(@course)), admin_resort_courses_list_path(@course.resort), target: :_blank %></div>
    <div class = "lower-gradient"></div>
    <div class="vjs-playlist">
      <div id="0" class="hole-home active">
        <%= link_to "javascript:void(0);" do %>
          <%= image_tag('hole-home.png') %>
        <% end %>
      </div>
      <div class="left-green">
        <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
         width="19px" viewBox="0 0 15.225 26.936" enable-background="new 0 0 15.225 26.936" xml:space="preserve" style="margin-top:8px;">
          <path fill-rule="evenodd" clip-rule="evenodd" fill="<%=color_selector(@course.color_selector)%>" d="M12.664,0.439c0.586-0.586,1.535-0.586,2.121,0
          c0.585,0.585,0.585,1.535,0,2.121L3.62,13.725l10.651,10.65c0.586,0.586,0.586,1.536,0,2.121c-0.586,0.586-1.535,0.586-2.121,0
          L0.439,14.785c-0.586-0.586-0.586-1.535,0-2.121L12.664,0.439z"/>
        </svg>
      </div>
      <div  class="playlist">
        <ul id="playlist" >
          <% @holes.try(:each) do |hole| %>
            <li id="<%=hole.hole_num%>" class= "hole-number" hole_image= "<%= hole.logo_image.present? ? hole.logo_image.url : logo_on_video(@course)%>" logo_hyperlink = "<%= hole.logo_hyperlink.present? ? hole.logo_hyperlink : hyperlink_on_video(@course)%>" color="<%=color_selector(@course.color_selector)%>">
              <%=link_to embed_hole_info_path(hole.id, hole_num: hole.hole_num), remote: true do %>
                <span><%= hole.hole_num %></span>
              <% end %>
            </li>
          <% end %>
        </ul>
      </div>
      <div class="right-green">
        <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
         width="19px" viewBox="0 0 15.225 26.936" enable-background="new 0 0 15.225 26.936" xml:space="preserve" style="margin-top:8px;">
          <path fill-rule="evenodd" clip-rule="evenodd" fill="<%=color_selector(@course.color_selector)%>" d="M2.561,0.439c-0.586-0.586-1.535-0.586-2.121,0
          c-0.585,0.585-0.585,1.535,0,2.121l11.165,11.164L0.953,24.375c-0.586,0.586-0.586,1.536,0,2.121c0.586,0.586,1.535,0.586,2.121,0
          l11.711-11.711c0.586-0.586,0.586-1.535,0-2.121L2.561,0.439z"/>
        </svg>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
  $(function(){
    $(".hole-home").on("click touchend", function(e) {
      $.ajax({
        url: '<%= embed_course_info_path(@course.id) %>',
        type: 'GET',
        dataType: "script"
      })
    });
    var videoList = []
    for (var i = 0, len = gon.videos_urls.length; i < len; i++) {
      videoList.push({
        sources: [{
          src: gon.videos_urls[i],
          type: 'video/mp4'
        }],
        poster: gon.image_urls[i]
      });
    }
    var player = videojs('home-vid', {
      controls: true, fluid:true,
      'playbackRates': [0.5, 1, 1.5, 2],
      abr: {enable: true},
      controlBar: {
        children: {
          'playToggle':{},
          'progressControl':{},
          'volumeMenuButton':{},
          'volumePanel': {inline: false},
          'playbackRateMenuButton':{},
          'fullscreenToggle':{}
        }
      }
    });

    try {player.volume(1);} catch (e) {}
    player.playlist(videoList);
    player.playlist.autoadvance(0);

    player.on('play', function(){
      var current_src = player.currentSrc();
      var playing_item = $("ul.playlist_thumb").find("[data-current-src='" + current_src + "']");
      $("li.playing").removeClass('playing');
      playing_item.addClass('playing');
    });

    player.on('ended', function(){
      $("li.playing").removeClass('playing');
    });

    $('.playlist_items').on('click', function(){
      var clicked_item = $(this).attr('data-video-index');
      var player = videojs('hole-vid');
      player.playlist.currentItem(parseInt(clicked_item));
    });

    $(".hole-number").click(function(){
      logoImage = $(this).attr('hole_image');
      logoHyperlink = $(this).attr('logo_hyperlink');
    })

    document.querySelector('.previous').addEventListener('click', function() {
      player.playlist.previous();
    });
    document.querySelector('.next').addEventListener('click', function() {
      player.playlist.next();
    });

    $('.player-container').hover(
      function(event){
        bgcolor = $(this).attr('progress-color');
        showBars();
        progressColor(bgcolor);
      }, function(){
        if (!player.paused()){
          hideBars();
        }
      }
    );

    var timer;

    player.on("loadedmetadata",function () {
      $firstElement = 0;
      if($(window).width() < 760 && player.paused()){
        showPlayerActions();
      }else{
        showBars();
      }
      timer = setTimeout(function(){hideBars()}, 5000);
    });

    player.on("userinactive",function () {
      if (!player.paused()){
        hideBars();
      }
    });

    player.on("useractive",function () {
        showBars();
        clearTimeout(timer);
    });

    document.querySelector('.right-green').addEventListener('click', function() {
      var nextActiveId;
      if($(window).width() < 350){
        nextActiveId = $firstElement + 1;
      }
      else if($(window).width() >= 350 && $(window).width() < 480){
        nextActiveId = $firstElement + 2;
      }
      else if($(window).width() >= 480 && $(window).width() < 600){
        nextActiveId = $firstElement + 3;
      }
      else if($(window).width() >= 600 && $(window).width() < 760){
        nextActiveId = $firstElement + 5;
      }
      else if($(window).width() >= 760 && $(window).width() < 960){
        nextActiveId = $firstElement + 6;
      }
      else if($(window).width() >= 960 && $(window).width() < 1200){
        nextActiveId = $firstElement + 9;
      }
      else if($(window).width() >= 1200){
        nextActiveId = $firstElement + 10;
      }
      if(nextActiveId == 0 || $("#playlist").find("#"+nextActiveId).size() != 0){
        scrollTo(nextActiveId);
        $firstElement = nextActiveId
      }
    });
    document.querySelector('.left-green').addEventListener('click', function() {
      var nextActiveId;
      if($(window).width() < 350){
        nextActiveId = $firstElement - 1;
      }
      else if($(window).width() >= 350 && $(window).width() < 480){
        nextActiveId = $firstElement - 2;
      }
      else if($(window).width() >= 480 && $(window).width() < 600){
        nextActiveId = $firstElement - 3;
      }
      else if($(window).width() >= 600 && $(window).width() < 760){
        nextActiveId = $firstElement - 5;
      }
      else if($(window).width() >= 760 && $(window).width() < 960){
        nextActiveId = $firstElement - 6;
      }
      else if($(window).width() >= 960 && $(window).width() < 1200){
        nextActiveId = $firstElement - 9;
      }
      else if($(window).width() >= 1200){
        nextActiveId = $firstElement - 10;
      }
      if (nextActiveId < 0){
        nextActiveId = 0
      }
      if(nextActiveId == 0 || $("#playlist").find("#"+nextActiveId).size() != 0){
        scrollTo(nextActiveId);
        $firstElement = nextActiveId
      }
    });

    function scrollTo(a){
      // currPos = $(".playlist").scrollLeft();
      liWidth = $(".playlist ul li").outerWidth(true);
      // liWidth = 100;
      scrollValue = a*liWidth;
      $('.playlist').animate( { scrollLeft: scrollValue }, 500);

    }
  })
</script>